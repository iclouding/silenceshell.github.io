---
layout: post
title: "反向过滤是个什么鬼？"
date: 2016-01-20 21:34:59
tags: kernel
author: 伊布
categories: tech
cover:  "/assets/instacode.png"
---

## 背景介绍

场景跟前面提到的fullnat是一样的。

ADS集群内存在计算节点1（10.0.103.96）写sysdb保存profile的情景；而sysdb提供服务的FRONT NODE可能在计算节点2（10.0.103.97）、计算节点3（10.0.103.98）上，通过SLB对外提供接入服务，如10.0.104.107:10000。
因此，计算节点1写sysdb时，需要从10.0.103.96发报文到10.0.104.107（源地址：目的地址为10.0.103.96:10.0.104.107），然后SLB做FULLNAT，将源地址、目的地址替换为10.0.103.107:10.0.103.97。

这里有一个问题，就是如何指导计算节点1将报文发送给SLB（10.0.104.107）？

目前我们的做法是在各个计算节点上配置路由为SLB的内部IP（10.0.103.107），即报文直接经VLAN 60转给SLB，报文从eth1口送上去给SLB；应答报文仍然经过eth1送给计算节点。
但这要求用户手工配置计算节点的路由，在部署的时候略为麻烦。

如果将计算节点的网关配置为vlan 60，报文可以经过vlan 60转到vlan 70，然后从eth0口上送给SLB，但SLB直接将报文丢弃了，并没有应答，连接建立失败。

![组网图](http://7xir15.com1.z0.glb.clouddn.com/temp4cj.png&e=1453300786&token=Wwt5nQTSc0Qs88Rj9B-KqNpAsY-iQraSaetEw1md:3vp3ff0I_apbkobrPUdl_5a1M0M)


## 解决方法






